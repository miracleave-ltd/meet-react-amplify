# 8. 自動デプロイ(CI/CD)の確認と設定変更

## 8.1. なぜ設定を変更するのか

実は`.gitignore`に`aws-exports.js`が含まれてしまっているため，このままだとフロントエンドのビルドで**aws-exports.jsファイルが見つからない**というエラーが発生します。<br>試しに前項からGitへプッシュするとデプロイで失敗となります（試しても試さなくても構いません）。AWSコンソール上でこの問題を解決していきます。

## 8.2. 環境変数の追加

AWSコンソールへアクセスし，Amplifyの環境変数を更新します。

以下のように`aws-exports.js`に書いてあるプログラム(`const`部から全てコピー）をコピーします。こちらが環境変数の値となります。変数名は`secretfile`としています。

![](./img/2021-05-06-09-33-15.png)

## 8.3. ビルド設定の追加

次はビルド設定を更新します。下図のとおりビルド設定に一行追加します。AWSコンソール上で修正してOKです。

![](./img/2021-05-06-09-40-25.png)

プログラムは以下となります。

```yml
version: 1
frontend:
  phases:
    preBuild:
      commands:
        # 追加
        - echo $secretfile > ./src/aws-exports.js
        - yarn install
    build:
      commands:
        - yarn run build
  artifacts:
    baseDirectory: build
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
```

## 8.4. 自動デプロイが成功するか確認

変更したコードをプッシュします。

```csharp
git add .
# コメントはお好きなように
git commit -m "modified amplify auth add."
git push
```

しばらくすると自動デプロイの正常完了が確認出来ます。

![](./img/2021-05-06-09-46-16.png)

## ex. コードを変更しない場合の手動デプロイ（再デプロイ）方法について

もし，デプロイ時の試している方は以下からGitプッシュを行わなくても再デプロイが可能です。赤枠部はリンクになっているので飛んだ先で手動での再デプロイが可能です。

![](./img/2021-05-06-09-50-03.png)

![](./img/2021-05-06-09-49-32.png)

ここまでで完了です。お疲れ様でした。<br>とはいえ今のままでは若干見た目も微妙なので，まだ時間に余力があれば次項を進めてください。