<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title></title>
        
        <meta name="robots" content="noindex" />
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="favicon.svg">
        
        
        <link rel="shortcut icon" href="favicon.png">
        
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        
        <link rel="stylesheet" href="css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="chapter_1.html"><strong aria-hidden="true">1.</strong> 環境作成</a></li><li class="chapter-item expanded "><a href="chapter_2.html"><strong aria-hidden="true">2.</strong> Reactアプリ作成</a></li><li class="chapter-item expanded "><a href="chapter_3.html"><strong aria-hidden="true">3.</strong> GitHubにpushする</a></li><li class="chapter-item expanded "><a href="chapter_4.html"><strong aria-hidden="true">4.</strong> Amplifyプロジェクトの設定</a></li><li class="chapter-item expanded "><a href="chapter_5.html"><strong aria-hidden="true">5.</strong> 自動デプロイの確認</a></li><li class="chapter-item expanded "><a href="chapter_6.html"><strong aria-hidden="true">6.</strong> Amplifyのユーザー作成</a></li><li class="chapter-item expanded "><a href="chapter_7.html"><strong aria-hidden="true">7.</strong> Amplifyプロジェクトの作成</a></li><li class="chapter-item expanded "><a href="chapter_8.html"><strong aria-hidden="true">8.</strong> Amplifyの認証サービスを追加する</a></li><li class="chapter-item expanded "><a href="chapter_9.html"><strong aria-hidden="true">9.</strong> Reactアプリに認証機能を追加する</a></li><li class="chapter-item expanded "><a href="chapter_10.html"><strong aria-hidden="true">10.</strong> 自動デプロイ(CI)の設定を変更</a></li><li class="chapter-item expanded "><a href="chapter_11.html"><strong aria-hidden="true">11.</strong> Amplifyの認証画面を日本語化し，Reactアプリレイアウトを整える</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#環境作成" id="環境作成">環境作成</a></h1>
<p>Dockerで作成していきますが，最終的なプログラムは<a href="https://github.com/miracleave-ltd/meet-react-amplify/tree/main/amplify-demo">こちら</a>になります。<br>プログラム変更時のエディタはVS Codeを使用していますが，もちろんご自身が使いたいエディタで問題ありません。<br>これからDockerコンテナを使用するためのファイルを作成しますが，以下のフォルダ構成でルートとなる<code>amplify-demo</code>のフォルダを作成して下さい。</p>
<pre><code class="language-sh"># Macの場合
/Users/{ユーザー名}/Projects/amplify-demo
├── Dockerfile
└── docker-compose.yml

# Windowsの場合
C:¥Useres¥{ユーザー名}¥Projects/amplify-demo
├── Dockerfile
└── docker-compose.yml
</code></pre>
<p>上記フォルダを作成したら配下に<a href="https://github.com/miracleave-ltd/meet-react-amplify/blob/main/amplify-demo/Dockerfile"><code>docker-compose.yml</code></a>と<a href="https://github.com/miracleave-ltd/meet-react-amplify/blob/main/amplify-demo/docker-compose.yml"><code>Dockerfile</code></a>を用意します。<br><a href="https://github.com/miracleave-ltd/meet-react-amplify/blob/main/amplify-demo/Dockerfile"><code>docker-compose.yml</code></a>は以下の通り。</p>
<pre><code class="language-yml">version: '3'

services:
    amplify:
        build: ./
        ports:
            - &quot;3000:3000&quot;
            - &quot;3001:3001&quot;
        volumes:
            - ./:/var/www/amplify-demo/
            - ./aws/:/root/.aws/
        tty: true
</code></pre>
<p><a href="https://github.com/miracleave-ltd/meet-react-amplify/blob/main/amplify-demo/docker-compose.yml"><code>Dockerfile</code></a>は以下の通り。</p>
<pre><code class="language-sh">FROM node:14.16.1

# amplify CLIをインストールする
RUN npm install -g @aws-amplify/cli

WORKDIR /var/www/amplify-demo
</code></pre>
<p>作成したファイルを使用してDockerを起動します。</p>
<pre><code>$ docker-compose up -d
</code></pre>
<p>立ち上がったらコンテナの中に入っていきますが，念の為，起動状態の確認とコンテナ名の確認を行います。以下の例だと<code>amplify-demo_amplify_1</code>がコンテナ名です。</p>
<pre><code class="language-sh">$ docker-compose ps
         Name                     Command            State              Ports            
-----------------------------------------------------------------------------------------
amplify-demo_amplify_1   docker-entrypoint.sh node   Up      0.0.0.0:8080-&gt;8080/tcp,     
                                                             0.0.0.0:8081-&gt;8081/tcp 
</code></pre>
<p>コンテナ名が確認出来たら，コンテナに入ります。</p>
<pre><code>$ docker exec -it {コンテナ名(上記のName)} bash
</code></pre>
<p>念の為，<code>node</code>と<code>npm</code>のバージョンを確認します。</p>
<pre><code class="language-sh">$ node -v &amp;&amp; npm -v
v14.16.1
6.14.12
</code></pre>
<p>さらに<code>amplify</code>もインストール出来ているか確認します。</p>
<pre><code class="language-sh">$ amplify --version
Initializing new Amplify CLI version...
Done initializing new version.
Scanning for plugins...
Plugin scan successful
4.50.2
</code></pre>
<p>要件を満たせているので，Reactアプリの作成をしていきます。</p>
<h1><a class="header" href="#2-reactアプリ作成" id="2-reactアプリ作成">2. Reactアプリ作成</a></h1>
<p>早速作成していきます。</p>
<pre><code class="language-sh">$ npx create-react-app react-amplify --template typescript
</code></pre>
<p>しばらく時間がかかるので少し待ちましょう。</p>
<p><code>Happy hacking!</code>とコンソールに表示されたらReactアプリの起動を確認します。</p>
<pre><code>$ cd react-amplify
$ yarn start
</code></pre>
<p>以下の通り，画面が表示されたらOKです。</p>
<p><img src="./img/2021-05-05-23-42-02.png" alt="" /></p>
<p>次はGitHubへリポジトリを作成し，ここまでの内容をプッシュしていきます。</p>
<h1><a class="header" href="#3-githubにpushする" id="3-githubにpushする">3. GitHubにpushする</a></h1>
<p>ご自身のGitHubアカウントへアクセスし，新しくリポジトリを作成します。</p>
<p><img src="./img/2021-05-05-23-52-17.png" alt="" /></p>
<p>公開範囲は<strong>public</strong>でも<strong>private</strong>のどちらでもお好きな方を選択してください。</p>
<p><img src="./img/2021-05-06-00-01-52.png" alt="" /></p>
<p>リポジトリを作成したら以下を実行しますが，Dockerのコンテナ内から実行するため，メールアドレスとユーザー名はご自身の環境に合わせて下さい。実行時にユーザー名とパスワードが求められます。</p>
<pre><code class="language-bash">$ git init
# ※ご自身の環境に合わせて下さい
$ git config --global user.email &quot;your-mailaddress@example.com&quot;
$ git config --global user.name &quot;your name&quot;
$ git add .
$ git commit -m &quot;first commit&quot;
$ git branch -M main
# ※ご自身の環境に合わせて下さい
$ git remote add origin https://github.com/{your name}/react-amplify.git
$ git push -u origin main
</code></pre>
<p>以下の通り，反映されていればOKです。</p>
<p><img src="./img/2021-05-06-00-31-53.png" alt="" /></p>
<p>ここまで完了したらAWSコンソールからAmplifyを使用してデプロイします。</p>
<h1><a class="header" href="#4-amplifyでデプロイ" id="4-amplifyでデプロイ">4. Amplifyでデプロイ</a></h1>
<p>AWSコンソールにサインインし，Amplifyサービスを検索，選択します。</p>
<p><img src="./img/2021-05-06-00-49-35.png" alt="" /></p>
<p>Amplifyのサービス画面に移動したらページ下部のDeliverのGet startedを選択します。</p>
<p><img src="./img/2021-05-06-00-53-19.png" alt="" /></p>
<p>GitHubを選択し，次へ進みます。</p>
<p><img src="./img/2021-05-06-00-56-16.png" alt="" /></p>
<p>GitHubの認証が必要なので完了させると以下のとおり，リポジトリと連携出来るようになります。<br>前項で作成したリポジトリの<code>react-amplify</code>を選択し，<strong>次へ</strong>を選択します。</p>
<p><img src="./img/2021-05-06-00-58-58.png" alt="" /></p>
<p>ビルド設定の構成ではデフォルトのまま，<strong>次へ</strong>を選択します。</p>
<p><img src="./img/2021-05-06-01-07-18.png" alt="" /></p>
<p>確認まで進んだら<strong>保存してデプロイ</strong>を選択します。</p>
<p><img src="./img/2021-05-06-01-09-10.png" alt="" /></p>
<p>Amplifyによって自動でビルドされ、アプリが公開されますが<strong>検証</strong>まで完了するのは少し時間がかかります。下図の赤枠部から公開されたページに飛べます。</p>
<p><img src="./img/2021-05-06-01-13-13.png" alt="" /></p>
<p>完了すると「2. Reactアプリ作成」で最後に確認した同じ画面が表示されます。</p>
<p><img src="./img/2021-05-05-23-42-02.png" alt="" /></p>
<p>次はReactのコードを変更して，自動デプロイが出来るようになっているか確認していきます。</p>
<h1><a class="header" href="#5-自動デプロイの確認" id="5-自動デプロイの確認">5. 自動デプロイの確認</a></h1>
<p><code>react-amplify/src/App.tsx</code>ファイルを修正します。軽微な修正なので下図の通り，修正します。</p>
<p><img src="./img/2021-05-06-01-19-44.png" alt="" /></p>
<p>コードは以下です。</p>
<pre><code class="language-jsx">import React from 'react';
import logo from './logo.svg';
import './App.css';

function App() {
  return (
    &lt;div className=&quot;App&quot;&gt;
      &lt;header className=&quot;App-header&quot;&gt;
        &lt;img src={logo} className=&quot;App-logo&quot; alt=&quot;logo&quot; /&gt;
        &lt;p&gt;
          Hello Amplify!!
        &lt;/p&gt;
        &lt;a
          className=&quot;App-link&quot;
          href=&quot;https://reactjs.org&quot;
          target=&quot;_blank&quot;
          rel=&quot;noopener noreferrer&quot;
        &gt;
          Learn React
        &lt;/a&gt;
      &lt;/header&gt;
    &lt;/div&gt;
  );
}

export default App;
</code></pre>
<p>変更したらプッシュします。</p>
<pre><code>$ git add src/App.tsx
$ git commit -m &quot;change App.tsx&quot;
$ git push
</code></pre>
<p>プッシュしたらAWSコンソールへ行き，確認します。mainブランチのプッシュを検知して自動デプロイがトリガーされているのがわかります。</p>
<p><img src="./img/2021-05-06-01-28-50.png" alt="" /></p>
<p>修正箇所が反映されているのを確認出来たらOKです。</p>
<p><img src="./img/2021-05-06-01-31-15.png" alt="" /></p>
<p>次はAmplifyの設定を進めていきます。</p>
<h1><a class="header" href="#6-amplifyのユーザー作成" id="6-amplifyのユーザー作成">6. Amplifyのユーザー作成</a></h1>
<p>Dockerコンテナに入った状態で実施していきます。amplifyの設定をしますが以下コマンド実行後は設問となるので注意して下さい。</p>
<pre><code class="language-sh">$ amplify configure
Initializing new Amplify CLI version...
Done initializing new version.
Scanning for plugins...
Plugin scan successful
Follow these steps to set up access to your AWS account:

Sign in to your AWS administrator account:
https://console.aws.amazon.com/
Press Enter to continue
# Enterを押してOKです
Specify the AWS Region
# 以下を選択しましょう
? region:  ap-northeast-1
Specify the username of the new IAM user:
# dev-amplifyとします
? user name:  dev-amplify
Complete the user creation using the AWS console
https://console.aws.amazon.com/iam/home?region=ap-northeast-1#/users$new?step=final&amp;accessKey&amp;userNames=dev-amplify&amp;permissionType=policies&amp;policies=arn:aws:iam::aws:policy%2FAdministratorAccess
Press Enter to continue
# 上記URLにアクセスしてユーザの確認をします（下図を参照）
Enter the access key of the newly created user:
# 画像内のアクセスキーIDをコピペします
? accessKeyId:  ********************
# 画像内のシークレットアクセスキーをコピペします
? secretAccessKey:  ****************************************
This would update/create the AWS Profile in your local machine
# デフォルトを選択します
? Profile Name:  default

Successfully set up the new user.
</code></pre>
<p>これでawsフォルダ配下にIAMのプロファイルが生成されます。</p>
<p>コンソール内のURLにアクセスすると以下の画面が表示されますので，ユーザー名を確認して次へ。
<img src="./img/2021-05-06-01-49-19.png" alt="" /></p>
<p>既存ポリシーはそのままで次へ。
<img src="./img/2021-05-06-01-49-32.png" alt="" /></p>
<p>タグは得に設定せず次へ（設定したい方は設定しても可です）。
<img src="./img/2021-05-06-01-49-44.png" alt="" /></p>
<p>ユーザー名，アクセス権限，タグの確認を行いユーザーの作成を選択します。
<img src="./img/2021-05-06-01-49-53.png" alt="" /></p>
<p>ユーザーが追加されるのでアクセスキーID，シークレットアクセスキーを控えて下さい。<br>csvのダウンロードでも可です。
<img src="./img/2021-05-06-01-50-01.png" alt="" /></p>
<h1><a class="header" href="#7-amplifyプロジェクトの作成" id="7-amplifyプロジェクトの作成">7. Amplifyプロジェクトの作成</a></h1>
<p>引き続きDockerコンテナに入った状態で実施していきます。こちらも前項と同じく，以下コマンド実行後は設問となるので注意して下さい。</p>
<pre><code class="language-sh">$ amplify init
Note: It is recommended to run this command from the root of your app directory
# Enterを押します
? Enter a name for the project reactamplify
The following configuration will be applied:

Project information
| Name: reactamplify
| Environment: dev
| Default editor: Visual Studio Code
| App type: javascript
| Javascript framework: react
| Source Directory Path: src
| Distribution Directory Path: build
| Build Command: npm run-script build
| Start Command: npm run-script start

# Yesを選択
? Initialize the project with the above configuration? Yes
Using default provider  awscloudformation
# AWS profileを選択
? Select the authentication method you want to use: AWS profile

For more information on AWS Profiles, see:
https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-profiles.html

# defaultを選択
? Please choose the profile you want to use default
Adding backend environment dev to AWS Amplify Console app: d2nvyvjheogdaz
⠇ Initializing project in the cloud...

# 途中略...

✔ Successfully created initial AWS cloud resources for deployments.
✔ Initialized provider successfully.
Initialized your environment successfully.

Your project has been successfully initialized and connected to the cloud!

Some next steps:
&quot;amplify status&quot; will show you what you've added already and if it's locally configured or deployed
&quot;amplify add &lt;category&gt;&quot; will allow you to add features like user login or a backend API
&quot;amplify push&quot; will build all your local backend resources and provision it in the cloud
&quot;amplify console&quot; to open the Amplify Console and view your project status
&quot;amplify publish&quot; will build all your local backend and frontend resources (if you have hosting category added) and provision it in the cloud

Pro tip:
Try &quot;amplify add api&quot; to create a backend API and then &quot;amplify publish&quot; to deploy everything
</code></pre>
<p>完了したら<code>react-amplify</code>の配下に<code>amplify</code>フォルダが作成されます。<br>Amplifyプロジェクトの作成が完了したら，Amplifyの認証を進めます。</p>
<h1><a class="header" href="#8-amplifyの認証サービスを追加する" id="8-amplifyの認証サービスを追加する">8. Amplifyの認証サービスを追加する</a></h1>
<p>こちらも前項と同じく，以下コマンド実行を行いますが，同じように設問となるので注意して下さい。</p>
<pre><code class="language-sh">$ amplify add auth
Using service: Cognito, provided by: awscloudformation
 
 The current configured provider is Amazon Cognito. 
 # Default configurationを選択する
 Do you want to use the default authentication and security configuration? Default config
uration
 Warning: you will not be able to edit these selections. 
 # Usernameを選択
 How do you want users to be able to sign in? Username
 # No, I am done.を選択
 Do you want to configure advanced settings? No, I am done.
</code></pre>
<p><strong>Successfully</strong>まで表示されたら，追加したauthをデプロイします。数分かかるので待ちます。</p>
<pre><code class="language-sh">$ amplify push --y
</code></pre>
<p>完了すると<code>reactamplify</code>の認証アプリが作成されます。以下のコマンドでAWSコンソール上でも確認出来ます。</p>
<pre><code class="language-sh">$ amplify console
# Consoleを選択 
✔ Which site do you want to open? · Console
</code></pre>
<p>次はReactアプリへ認証機能を追加していきます。</p>
<h1><a class="header" href="#9-reactアプリに認証機能を追加する" id="9-reactアプリに認証機能を追加する">9. Reactアプリに認証機能を追加する</a></h1>
<p>ReactアプリにAmplifyライブラリをインストールします。</p>
<pre><code class="language-sh">$ npm install aws-amplify @aws-amplify/ui-react
</code></pre>
<p><code>react-amplify/src/index.tsx</code>を修正する。</p>
<pre><code class="language-jsx">// index.tsx
import React from 'react';
import ReactDOM from 'react-dom';
import './index.css';
import App from './App';
import reportWebVitals from './reportWebVitals';
import Amplify from 'aws-amplify';
import config from './aws-exports';
Amplify.configure(config);

ReactDOM.render(
  &lt;React.StrictMode&gt;
    &lt;App /&gt;
  &lt;/React.StrictMode&gt;,
  document.getElementById('root')
);

reportWebVitals();
</code></pre>
<p><code>react-amplify/src/App.tsx</code>を修正する。</p>
<pre><code class="language-jsx">import logo from './logo.svg';
import './App.css';
import { withAuthenticator, AmplifySignOut } from '@aws-amplify/ui-react'

function App() {
  return (
    &lt;div className=&quot;App&quot;&gt;
      &lt;header&gt;
        &lt;img src={logo} className=&quot;App-logo&quot; alt=&quot;logo&quot; /&gt;
        &lt;h1&gt;Hello Amplify!!&lt;/h1&gt;
      &lt;/header&gt;
      &lt;AmplifySignOut /&gt;
    &lt;/div&gt;
  );
}

export default withAuthenticator(App);
</code></pre>
<p>ここまで修正したら<code>yarn start</code>で起動しましょう。<code>http://localhost:3000/</code>でアクセスすると以下の画面が表示されます。<br>画面内の<strong>Create account</strong>からアカウントを作成します。</p>
<p><img src="./img/2021-05-06-06-37-41.png" alt="" /></p>
<p>アカウントの作成画面に移動するので，作成します。次の画面で確認コードを入力する必要があるので，<strong>有効なメールアドレス</strong>を入力して下さい。</p>
<p><img src="./img/2021-05-06-06-43-41.png" alt="" /></p>
<p><img src="./img/2021-05-06-06-46-07.png" alt="" /></p>
<p>送られてきたメールの確認コードを入力するとログイン出来ます。</p>
<p><img src="./img/2021-05-06-06-47-32.png" alt="" /></p>
<p>この時点での成果をプッシュしていき，自動デプロイの結果も確認したいところですが，AWSコンソール上でAmplifyの設定を更新する箇所がありますので次項で進めます。</p>
<h1><a class="header" href="#10-自動デプロイciの設定を変更" id="10-自動デプロイciの設定を変更">10. 自動デプロイ(CI)の設定を変更</a></h1>
<p>実は<code>.gitignore</code>に<code>aws-exports.js</code>が含まれてしまっているため，このままだとフロントエンドのビルドで<strong>aws-exports.jsファイルが見つからない</strong>というエラーが発生します。<br>試しに前項からGitへプッシュするとデプロイで失敗となります（試しても試さなくても構いません）。<br>これを解決するためにAmplifyの環境変数とビルド設定を更新します。<br>
まずは環境変数を設定します。</p>
<p>以下のように<code>aws-exports.js</code>に書いてあるプログラムをコピーします。こちらが環境変数の値となります。変数名は<code>secretfile</code>としています。</p>
<p><img src="./img/2021-05-06-09-33-15.png" alt="" /></p>
<p>次はビルド設定を更新します。下図のとおりビルド設定に一行追加します。AWSコンソール上で修正してOKです。</p>
<p><img src="./img/2021-05-06-09-40-25.png" alt="" /></p>
<p>プログラム上は以下となります。</p>
<pre><code class="language-yml">version: 1
frontend:
  phases:
    preBuild:
      commands:
        # 追加
        - echo $secretfile &gt; ./src/aws-exports.js
        - yarn install
    build:
      commands:
        - yarn run build
  artifacts:
    baseDirectory: build
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
</code></pre>
<p>では変更したコードをプッシュします。</p>
<pre><code>$ git add .
# コメントはお好きなように
$ git commit -m &quot;modified amplify auth add.&quot;
$ git push
</code></pre>
<p>しばらくすると自動デプロイが正常に完了することが確認出来ます。</p>
<p><img src="./img/2021-05-06-09-46-16.png" alt="" /></p>
<p>もし，デプロイ時の試している方は以下からGitプッシュを行わなくても再デプロイが可能です。赤枠部はリンクになっているので飛んだ先で手動での再デプロイが可能です。</p>
<p><img src="./img/2021-05-06-09-50-03.png" alt="" /></p>
<p><img src="./img/2021-05-06-09-49-32.png" alt="" /></p>
<p>ここまでで完了です。お疲れ様でした。<br>とはいえ今のままでは若干見た目も微妙なので，まだ時間に余力があれば次項を進めてください。</p>
<h1><a class="header" href="#11-amplifyの認証画面を日本語化する" id="11-amplifyの認証画面を日本語化する">11. Amplifyの認証画面を日本語化する</a></h1>
<p>ここでは，Amplifyで提供されているコンポーネントを日本語化し，ログイン後の画面を簡素ですが少しだけ変更する，という事を進めます。本当に簡易的なレイアウト追加なので付録的な内容だと思っていただければと思います。最終的には以下の画面になります。</p>
<p>ログイン
<img src="./img/2021-05-06-09-55-13.png" alt="" /></p>
<p>ログイン後
<img src="./img/2021-05-06-09-55-42.png" alt="" /></p>
<p>semantic-uiをインストールします（長いです）。インストールが完了したら次へ進みます。</p>
<pre><code class="language-sh">$ npm install semantic-ui-react semantic-ui-css
</code></pre>
<p>追加と修正を行うファイルは下図の赤枠が対象です。</p>
<p><img src="./img/2021-05-06-10-30-52.png" alt="" /></p>
<p>日本語化用のファイルを作成します。</p>
<p><code>react-amplify/src/assets/i18n/amplify/</code>のフォルダを作成し，配下に<code>localization.js</code>を作成します。<br>翻訳辞書的な内容ですが，これでも全てカバー出来ないとは思いますので気休め程度に。</p>
<pre><code class="language-javascript">// localization.js
export const localization = {
  ja: {
      'Sign In': 'サインイン',
      'Sign Up': 'サインアップ',
      'Sign Out': 'サインアウト',
      'Sign in to your account': 'アカウントにサインイン',
      'Username *': 'ユーザー名 *',
      'Password *': 'パスワード *',
      'Enter your username': 'ユーザー名を入力',
      'Enter your password': 'パスワードを入力',
      'No account?': 'アカウントが未登録ですか？',
      'Forgot your password?': 'パスワードをお忘れですか？',
      'Reset password': 'パスワードをリセット',
      'User does not exist': 'ユーザーが存在しません',
      'User already exists': 'ユーザーは既に存在します',
      'Incorrect username or password.': 'ユーザー名またはパスワードが違います',
      'Invalid password format': 'パスワードのフォーマットが不正です',
      'Create account': 'アカウントを作成',
      'Forgot Password': 'パスワードを忘れた',
      'Change Password': 'パスワードを変更',
      'New Password': '新しいパスワード',
      'Email': 'Email',
      'Phone Number': '電話番号',
      'Confirm a Code': 'コードを確認',
      'Confirm Sign In': 'サインインを確認',
      'Confirm Sign up': 'サインアップを確認',
      'Back to Sign In': 'サインインに戻る',
      'Send Code': 'コードを送信',
      'Confirm': '確認',
      'Resend Code': 'コードを再送',
      'Submit': '送信',
      'Skip': 'スキップ',
      'Verify': '検証',
      'Verify Contact': '連絡先を検証',
      'Code': 'Code',
      'Confirmation Code': '確認コード',
      'Lost your code?': 'コードがありませんか？',
      'Account recovery requires verified contact information': 'Account recovery requires verified contact information',
      'Invalid phone number format': '不正な電話番号フォーマットです。 電話番号は次のフォーマットで入力してください: +12345678900',
      'Create Account': 'アカウントを作成',
      'Have an account?': 'アカウントをお持ちですか？',
      'Sign in': 'サインイン',
      'Create a new account': '新しいアカウントを作成',
      'Reset your password': 'パスワードをリセット',
      'An account with the given email already exists.': 'そのメールアドレスは既に存在します',
      'Username cannot be empty': 'ユーザー名は必須です',
      'Password attempts exceeded': 'パスワード試行回数が超過しました',
      'Email Address *': 'メールアドレス',
      'Phone Number *': '電話番号',
      'User does not exist.': '存在しないユーザーです'
  },
};
</code></pre>
<p>ログイン後のコンポーネントを作成します。</p>
<p><code>react-amplify/src/layout</code>フォルダを作成します。このフォルダ配下に<code>NavBar.tsx</code>と<code>DemoContent.tsx</code>を追加していきます。<br>まず，<code>NavBar.tsx</code>を追加します。これは<code>App.tsx</code>で渡ってくるログインしたユーザー名を受け取りますが，この時点ではこのまま書いてもエラーが出ると思いますが，最後の<code>App.tsx</code>まで修正すると解消するので一旦は無視しましょう。</p>
<pre><code class="language-ts">// NavBar.tsx(ログイン後のヘッダー部)
import { AmplifySignOut } from '@aws-amplify/ui-react';
import logo from '../logo.svg';
import React, { FC } from 'react';
import { Container, Menu } from 'semantic-ui-react';
import 'semantic-ui-css/semantic.min.css'

type NavProps = {
  username: string;
}

 const NavBar: FC&lt;NavProps&gt; = (navProps) =&gt; {
  const { username } = navProps;
  return (
    &lt;Menu block='true' inverted&gt;
      &lt;Container&gt;
        &lt;Menu.Item header&gt;
          &lt;img src={logo} alt=&quot;logo&quot; /&gt;
            Hello {username} !!
        &lt;/Menu.Item&gt;
        &lt;Menu.Item position='right'&gt;
          &lt;AmplifySignOut /&gt;
        &lt;/Menu.Item&gt;
      &lt;/Container&gt;
    &lt;/Menu&gt;
  )
}
export default NavBar;
</code></pre>
<p><code>DemoContent.tsx</code>を追加。あくまで飾り程度の残念コンポーネントです。こちらは何も動的な動作をしないので，特にエラーは起こりません。</p>
<pre><code class="language-ts">// DemoContent.tsx
import { Card, Container, Icon, Image } from &quot;semantic-ui-react&quot;;

export default function DemoContent() {
    return (
      &lt;Container&gt;
        &lt;Card.Group&gt;
          &lt;Card&gt;
            &lt;Image src='https://react.semantic-ui.com/images/avatar/large/matthew.png' wrapped ui={false} /&gt;
            &lt;Card.Content&gt;
              &lt;Card.Header&gt;Matthew&lt;/Card.Header&gt;
              &lt;Card.Meta&gt;
                &lt;span className='date'&gt;Joined in 2015&lt;/span&gt;
              &lt;/Card.Meta&gt;
              &lt;Card.Description&gt;
                Matthew is a musician living in Nashville.
              &lt;/Card.Description&gt;
            &lt;/Card.Content&gt;
            &lt;Card.Content extra&gt;
              &lt;a href=&quot;example.com&quot;&gt;
                &lt;Icon name='user' /&gt;
                12 Friends
              &lt;/a&gt;
            &lt;/Card.Content&gt;
          &lt;/Card&gt;
          &lt;Card&gt;
            &lt;Image src='https://react.semantic-ui.com/images/avatar/large/elliot.jpg' wrapped ui={false} /&gt;
            &lt;Card.Content&gt;
              &lt;Card.Header&gt;elliot&lt;/Card.Header&gt;
              &lt;Card.Meta&gt;
                &lt;span className='date'&gt;Joined in 2021&lt;/span&gt;
              &lt;/Card.Meta&gt;
              &lt;Card.Description&gt;
              Elliot is a sound engineer living in Nashville who enjoys playing guitar and hanging with his cat.
              &lt;/Card.Description&gt;
            &lt;/Card.Content&gt;
            &lt;Card.Content extra&gt;
              &lt;a href=&quot;example.com&quot;&gt;
                &lt;Icon name='user' /&gt;
                20 Friends
              &lt;/a&gt;
            &lt;/Card.Content&gt;
          &lt;/Card&gt;
          &lt;Card&gt;
            &lt;Image src='https://react.semantic-ui.com/images/avatar/large/steve.jpg' wrapped ui={false} /&gt;
            &lt;Card.Content&gt;
              &lt;Card.Header&gt;Steve Sanders&lt;/Card.Header&gt;
              &lt;Card.Meta&gt;
                &lt;span className='date'&gt;Joined in 2015&lt;/span&gt;
              &lt;/Card.Meta&gt;
              &lt;Card.Description&gt;
              Steve wants to add you to the group &lt;strong&gt;best friends&lt;/strong&gt;
              &lt;/Card.Description&gt;
            &lt;/Card.Content&gt;
            &lt;Card.Content extra&gt;
              &lt;a href=&quot;example.com&quot;&gt;
                &lt;Icon name='user' /&gt;
                18 Friends
              &lt;/a&gt;
            &lt;/Card.Content&gt;
          &lt;/Card&gt;
          &lt;Card&gt;
            &lt;Image src='https://react.semantic-ui.com/images/avatar/large/molly.png' wrapped ui={false} /&gt;
            &lt;Card.Content&gt;
              &lt;Card.Header&gt;molly&lt;/Card.Header&gt;
              &lt;Card.Meta&gt;
                &lt;span className='date'&gt;Joined in 2019&lt;/span&gt;
              &lt;/Card.Meta&gt;
              &lt;Card.Description&gt;
                molly is a musician living in Nashville.
              &lt;/Card.Description&gt;
            &lt;/Card.Content&gt;
            &lt;Card.Content extra&gt;
              &lt;a href=&quot;example.com&quot;&gt;
                &lt;Icon name='user' /&gt;
                2 Friends
              &lt;/a&gt;
            &lt;/Card.Content&gt;
          &lt;/Card&gt;
        &lt;/Card.Group&gt;
      &lt;/Container&gt;
    )
}
</code></pre>
<p>日本語化の内容を適用するために<code>index.tsx</code>を修正します。</p>
<pre><code class="language-ts">// index.tsx
import React from 'react';
import ReactDOM from 'react-dom';
import './index.css';
import App from './App';
import reportWebVitals from './reportWebVitals';
import Amplify, { I18n } from 'aws-amplify';
import { localization } from './assets/i18n/amplify/localization';
import config from './aws-exports';
Amplify.configure(config);

I18n.putVocabularies(localization);
I18n.setLanguage('ja');

ReactDOM.render(
  &lt;React.StrictMode&gt;
    &lt;App /&gt;
  &lt;/React.StrictMode&gt;,
  document.getElementById('root')
);

reportWebVitals();
</code></pre>
<p>ログイン時と非ログイン時の出し分けと，ユーザー名を<code>NavBar</code>コンポーネントに渡すくらいしかしていませんが，最後に<code>App.tsx</code>を修正します。</p>
<pre><code class="language-ts">// App.tsx
import React, { useEffect, useState } from 'react';
import './App.css';
import {AmplifyAuthenticator } from '@aws-amplify/ui-react';
import { AuthState, onAuthUIStateChange} from &quot;@aws-amplify/ui-components&quot;;
import NavBar from './layout/NavBar';
import DemoContent from './layout/DemoContent';

const App = () =&gt; {
  const [authState, setAuthState] = useState&lt;AuthState&gt;();
  const [user, setUser] = useState&lt;any&gt;(); 

  useEffect(() =&gt; {
    return onAuthUIStateChange((nextAuthState, authData) =&gt; {
      setAuthState(nextAuthState);
      setUser(authData);
    });
  }, []);

  return authState === AuthState.SignedIn &amp;&amp; user ? (
    &lt;div&gt;
        &lt;NavBar username={user.username}/&gt;
        &lt;DemoContent /&gt;
    &lt;/div&gt;
  ) : (
      &lt;AmplifyAuthenticator /&gt;
  );
}

export default App;
</code></pre>
<p>これでざっくりと画面レイアウトを変更出来たので，完了となります。AmplifyのコンポーネントやらAPIもかなり用意されているようですが，これを使いこなすのはなかなか大変ですね。<br>これにて「mirameet vol.16」のハンズオンは終了となります。ご参加いただいた方，お疲れ様でした。</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        
        
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
        
        

    </body>
</html>
