<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title></title>
        
        <meta name="robots" content="noindex" />
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="favicon.svg">
        
        
        <link rel="shortcut icon" href="favicon.png">
        
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        
        <link rel="stylesheet" href="css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="chapter_1.html"><strong aria-hidden="true">1.</strong> 環境作成</a></li><li class="chapter-item expanded "><a href="chapter_2.html"><strong aria-hidden="true">2.</strong> Reactアプリ作成</a></li><li class="chapter-item expanded "><a href="chapter_3.html"><strong aria-hidden="true">3.</strong> GitHubにpushする</a></li><li class="chapter-item expanded "><a href="chapter_4.html"><strong aria-hidden="true">4.</strong> Amplifyプロジェクトの設定</a></li><li class="chapter-item expanded "><a href="chapter_5.html"><strong aria-hidden="true">5.</strong> 自動デプロイの確認</a></li><li class="chapter-item expanded "><a href="chapter_6.html"><strong aria-hidden="true">6.</strong> Amplifyのユーザー作成</a></li><li class="chapter-item expanded "><a href="chapter_7.html"><strong aria-hidden="true">7.</strong> Amplifyプロジェクトの作成</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#環境作成" id="環境作成">環境作成</a></h1>
<p>Dockerで作成します。</p>
<p><code>docker-compose.yml</code>と<code>Dockerfile</code>を用意します。<br><code>docker-compose.yml</code>は以下の通り。</p>
<pre><code class="language-yml">version: '3'

services:
    amplify:
        build: ./
        ports:
            - &quot;3000:3000&quot;
            - &quot;3001:3001&quot;
        volumes:
            - ./:/var/www/amplify-demo/
            - ./aws/:/root/.aws/
        tty: true
</code></pre>
<p><code>Dockerfile</code>は以下の通り。</p>
<pre><code class="language-sh">FROM node:14.16.1

# amplify CLIをインストールする
RUN npm install -g @aws-amplify/cli

WORKDIR /var/www/amplify-demo
</code></pre>
<p>上記ファイルを配置するディレクトリは以下の通りです（Mac）。</p>
<pre><code>/Users/{ユーザー名}/Projects/amplify-demo
├── Dockerfile
└── docker-compose.yml
</code></pre>
<p>作成したファイルを使用してDockerを起動します。</p>
<pre><code>$ docker-compose up -d
</code></pre>
<p>立ち上がったらコンテナの中に入っていきますが，念の為，起動状態の確認とコンテナ名の確認を行います。以下の例だと<code>amplify-demo_amplify_1</code>がコンテナ名です。</p>
<pre><code class="language-sh">$ docker-compose ps
         Name                     Command            State              Ports            
-----------------------------------------------------------------------------------------
amplify-demo_amplify_1   docker-entrypoint.sh node   Up      0.0.0.0:8080-&gt;8080/tcp,     
                                                             0.0.0.0:8081-&gt;8081/tcp 
</code></pre>
<p>コンテナ名が確認出来たら，コンテナに入ります。</p>
<pre><code>$ docker exec -it {コンテナ名(上記のName)} bash
</code></pre>
<p>念の為，<code>node</code>と<code>npm</code>のバージョンを確認します。</p>
<pre><code class="language-sh">$ node -v &amp;&amp; npm -v
v14.16.1
6.14.12
</code></pre>
<p>さらに<code>amplify</code>もインストール出来ているか確認します。</p>
<pre><code class="language-sh">$ amplify --version
Initializing new Amplify CLI version...
Done initializing new version.
Scanning for plugins...
Plugin scan successful
4.50.2
</code></pre>
<p>要件を満たせているので，Reactアプリの作成をしていきます。</p>
<h1><a class="header" href="#2-reactアプリ作成" id="2-reactアプリ作成">2. Reactアプリ作成</a></h1>
<p>早速作成していきます。</p>
<pre><code class="language-sh">$ npx create-react-app react-amplify --template typescript
</code></pre>
<p>しばらく時間がかかるので少し待ちましょう。</p>
<p><code>Happy hacking!</code>とコンソールに表示されたらReactアプリの起動を確認します。</p>
<pre><code>$ cd react-amplify
$ yarn start
</code></pre>
<p>以下の通り，画面が表示されたらOKです。</p>
<p><img src="./img/2021-05-05-23-42-02.png" alt="" /></p>
<p>次はGitHubへリポジトリを作成し，ここまでの内容をプッシュしていきます。</p>
<h1><a class="header" href="#3-githubにpushする" id="3-githubにpushする">3. GitHubにpushする</a></h1>
<p>ご自身のGitHubアカウントへアクセスし，新しくリポジトリを作成します。</p>
<p><img src="./img/2021-05-05-23-52-17.png" alt="" /></p>
<p>公開範囲は<strong>public</strong>でも<strong>private</strong>のどちらでもお好きな方を選択してください。</p>
<p><img src="./img/2021-05-06-00-01-52.png" alt="" /></p>
<p>リポジトリを作成したら以下を実行しますが，Dockerのコンテナ内から実行するため，メールアドレスとユーザー名はご自身の環境に合わせて下さい。実行時にユーザー名とパスワードが求められます。</p>
<pre><code class="language-bash">$ git init
# ※ご自身の環境に合わせて下さい
$ git config --global user.email &quot;your-mailaddress@example.com&quot;
$ git config --global user.name &quot;your name&quot;
$ git add .
$ git commit -m &quot;first commit&quot;
$ git branch -M main
# ※ご自身の環境に合わせて下さい
$ git remote add origin https://github.com/{your name}/react-amplify.git
$ git push -u origin main
</code></pre>
<p>以下の通り，反映されていればOKです。</p>
<p><img src="./img/2021-05-06-00-31-53.png" alt="" /></p>
<p>ここまで完了したらAWSコンソールからAmplifyを使用してデプロイします。</p>
<h1><a class="header" href="#4-amplifyでデプロイ" id="4-amplifyでデプロイ">4. Amplifyでデプロイ</a></h1>
<p>AWSコンソールにサインインし，Amplifyサービスを検索，選択します。</p>
<p><img src="./img/2021-05-06-00-49-35.png" alt="" /></p>
<p>Amplifyのサービス画面に移動したらページ下部のDeliverのGet startedを選択します。</p>
<p><img src="./img/2021-05-06-00-53-19.png" alt="" /></p>
<p>GitHubを選択し，次へ進みます。</p>
<p><img src="./img/2021-05-06-00-56-16.png" alt="" /></p>
<p>GitHubの認証が必要なので完了させると以下のとおり，リポジトリと連携出来るようになります。<br>前項で作成したリポジトリの<code>react-amplify</code>を選択し，<strong>次へ</strong>を選択します。</p>
<p><img src="./img/2021-05-06-00-58-58.png" alt="" /></p>
<p>ビルド設定の構成ではデフォルトのまま，<strong>次へ</strong>を選択します。</p>
<p><img src="./img/2021-05-06-01-07-18.png" alt="" /></p>
<p>確認まで進んだら<strong>保存してデプロイ</strong>を選択します。</p>
<p><img src="./img/2021-05-06-01-09-10.png" alt="" /></p>
<p>Amplifyによって自動でビルドされ、アプリが公開されますが<strong>検証</strong>まで完了するのは少し時間がかかります。下図の赤枠部から公開されたページに飛べます。</p>
<p><img src="./img/2021-05-06-01-13-13.png" alt="" /></p>
<p>完了すると「2. Reactアプリ作成」で最後に確認した同じ画面が表示されます。</p>
<p><img src="./img/2021-05-05-23-42-02.png" alt="" /></p>
<p>次はReactのコードを変更して，自動デプロイが出来るようになっているか確認していきます。</p>
<h1><a class="header" href="#5-自動デプロイの確認" id="5-自動デプロイの確認">5. 自動デプロイの確認</a></h1>
<p><code>react-amplify/src/App.tsx</code>ファイルを修正します。軽微な修正なので下図の通り，修正します。</p>
<p><img src="./img/2021-05-06-01-19-44.png" alt="" /></p>
<p>コードは以下です。</p>
<pre><code class="language-jsx">import React from 'react';
import logo from './logo.svg';
import './App.css';

function App() {
  return (
    &lt;div className=&quot;App&quot;&gt;
      &lt;header className=&quot;App-header&quot;&gt;
        &lt;img src={logo} className=&quot;App-logo&quot; alt=&quot;logo&quot; /&gt;
        &lt;p&gt;
          Hello Amplify!!
        &lt;/p&gt;
        &lt;a
          className=&quot;App-link&quot;
          href=&quot;https://reactjs.org&quot;
          target=&quot;_blank&quot;
          rel=&quot;noopener noreferrer&quot;
        &gt;
          Learn React
        &lt;/a&gt;
      &lt;/header&gt;
    &lt;/div&gt;
  );
}

export default App;
</code></pre>
<p>変更したらプッシュします。</p>
<pre><code>$ git add src/App.tsx
$ git commit -m &quot;change App.tsx&quot;
$ git push
</code></pre>
<p>プッシュしたらAWSコンソールへ行き，確認します。mainブランチのプッシュを検知して自動デプロイがトリガーされているのがわかります。</p>
<p><img src="./img/2021-05-06-01-28-50.png" alt="" /></p>
<p>修正箇所が反映されているのを確認出来たらOKです。</p>
<p><img src="./img/2021-05-06-01-31-15.png" alt="" /></p>
<p>次はAmplifyの設定を進めていきます。</p>
<h1><a class="header" href="#6-amplifyのユーザー作成" id="6-amplifyのユーザー作成">6. Amplifyのユーザー作成</a></h1>
<p>Dockerコンテナに入った状態で実施していきます。amplifyの設定をしますが以下コマンド実行後は設問となるので注意して下さい。</p>
<pre><code class="language-sh">$ amplify configure
Initializing new Amplify CLI version...
Done initializing new version.
Scanning for plugins...
Plugin scan successful
Follow these steps to set up access to your AWS account:

Sign in to your AWS administrator account:
https://console.aws.amazon.com/
Press Enter to continue
# Enterを押してOKです
Specify the AWS Region
# 以下を選択しましょう
? region:  ap-northeast-1
Specify the username of the new IAM user:
# dev-amplifyとします
? user name:  dev-amplify
Complete the user creation using the AWS console
https://console.aws.amazon.com/iam/home?region=ap-northeast-1#/users$new?step=final&amp;accessKey&amp;userNames=dev-amplify&amp;permissionType=policies&amp;policies=arn:aws:iam::aws:policy%2FAdministratorAccess
Press Enter to continue
# 上記URLにアクセスしてユーザの確認をします（下図を参照）
Enter the access key of the newly created user:
# 画像内のアクセスキーIDをコピペします
? accessKeyId:  ********************
# 画像内のシークレットアクセスキーをコピペします
? secretAccessKey:  ****************************************
This would update/create the AWS Profile in your local machine
# デフォルトを選択します
? Profile Name:  default

Successfully set up the new user.
</code></pre>
<p>これでawsフォルダ配下にIAMのプロファイルが生成されます。</p>
<p>コンソール内のURLにアクセスすると以下の画面が表示されますので，ユーザー名を確認して次へ。
<img src="./img/2021-05-06-01-49-19.png" alt="" /></p>
<p>既存ポリシーはそのままで次へ。
<img src="./img/2021-05-06-01-49-32.png" alt="" /></p>
<p>タグは得に設定せず次へ（設定したい方は設定しても可です）。
<img src="./img/2021-05-06-01-49-44.png" alt="" /></p>
<p>ユーザー名，アクセス権限，タグの確認を行いユーザーの作成を選択します。
<img src="./img/2021-05-06-01-49-53.png" alt="" /></p>
<p>ユーザーが追加されるのでアクセスキーID，シークレットアクセスキーを控えて下さい。<br>csvのダウンロードでも可です。
<img src="./img/2021-05-06-01-50-01.png" alt="" /></p>
<h1><a class="header" href="#7-amplifyプロジェクトの作成" id="7-amplifyプロジェクトの作成">7. Amplifyプロジェクトの作成</a></h1>
<p>引き続きDockerコンテナに入った状態で実施していきます。こちらも前項と同じく，以下コマンド実行後は設問となるので注意して下さい。</p>
<pre><code class="language-sh">$ amplify init
Note: It is recommended to run this command from the root of your app directory
? Enter a name for the project reactamplify
The following configuration will be applied:

Project information
| Name: reactamplify
| Environment: dev
| Default editor: Visual Studio Code
| App type: javascript
| Javascript framework: react
| Source Directory Path: src
| Distribution Directory Path: build
| Build Command: npm run-script build
| Start Command: npm run-script start

# Yesを選択
? Initialize the project with the above configuration? Yes
Using default provider  awscloudformation
# AWS profileを選択
? Select the authentication method you want to use: AWS profile

For more information on AWS Profiles, see:
https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-profiles.html

# defaultを選択
? Please choose the profile you want to use default
Adding backend environment dev to AWS Amplify Console app: d2nvyvjheogdaz
⠇ Initializing project in the cloud...

# 途中略...

✔ Successfully created initial AWS cloud resources for deployments.
✔ Initialized provider successfully.
Initialized your environment successfully.

Your project has been successfully initialized and connected to the cloud!

Some next steps:
&quot;amplify status&quot; will show you what you've added already and if it's locally configured or deployed
&quot;amplify add &lt;category&gt;&quot; will allow you to add features like user login or a backend API
&quot;amplify push&quot; will build all your local backend resources and provision it in the cloud
&quot;amplify console&quot; to open the Amplify Console and view your project status
&quot;amplify publish&quot; will build all your local backend and frontend resources (if you have hosting category added) and provision it in the cloud

Pro tip:
Try &quot;amplify add api&quot; to create a backend API and then &quot;amplify publish&quot; to deploy everything
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        
        
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
        
        

    </body>
</html>
